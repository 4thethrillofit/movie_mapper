(function e$$0(e,f,c){function g(a,l){if(!f[a]){if(!e[a]){var h="function"==typeof require&&require;if(!l&&h)return h(a,!0);if(b)return b(a,!0);throw Error("Cannot find module '"+a+"'");}h=f[a]={exports:{}};e[a][0].call(h.exports,function(b){var c=e[a][1][b];return g(c?c:b)},h,h.exports,e$$0,e,f,c)}return f[a].exports}for(var b="function"==typeof require&&require,a=0;a<c.length;a++)g(c[a]);return g})({1:[function(d,e,f){d("./libs/local_storage_extension");var c=d("./libs/google_maps_client"),g=d("./libs/sfmovies_client");
App={typeahead:d("./libs/typeahead_client"),initialize:function(){this.GoogleMaps=new c;d("./libs/google_maps_initializer")(this);this.SFMoviesClient=new g;this.SFMoviesClient.fetchCachedOrFreshData();this.typeahead.data.titles=this.SFMoviesClient.collectAllAttributes("title");this.typeahead.data.directors=this.SFMoviesClient.collectAllAttributes("director");this.typeahead.data.releaseYears=this.SFMoviesClient.collectAllAttributes("release_year");this.typeahead.initialize(this)},mobileMediaQuery:window.matchMedia("(max-width: 320px)")};
App.initialize();App.typeahead.setupListeners()},{"./libs/google_maps_client":2,"./libs/google_maps_initializer":3,"./libs/local_storage_extension":4,"./libs/sfmovies_client":5,"./libs/typeahead_client":6}],2:[function(d,e,f){function c(b){this.markers.forEach(function(a){a.setMap(b)})}function g(b,a){var k=this,c="<h4>"+a.title+"</h4><p><strong>Director:</strong> "+a.director+"</p><p><strong>Release Year:</strong> "+a.release_year+"</p><p><strong>Location:</strong> "+a.locations+"</p><img src='"+
a.streetView+"'/>";google.maps.event.addListener(b,"click",function(){k.infoWindow.close();k.infoWindow.setContent(c);k.infoWindow.open(this.map,b)})}d=function(){this.markers=[];this.map;this.infoWindow=new google.maps.InfoWindow};d.prototype.getLatLngFromAddress=function(b){var a="http://maps.googleapis.com/maps/api/geocode/json?address="+b.locations.replace(/ /g,"+")+"&sensor=false";$.ajax({url:a,dataType:"json",async:!1,success:function(a){"ZERO_RESULTS"===a.status?b.errors=a.status:(b.lat=a.results[0].geometry.location.lat,
b.lng=a.results[0].geometry.location.lng,b.streetView="http://maps.googleapis.com/maps/api/streetview?size=200x200&location="+b.lat+","+b.lng+"&fov=120&sensor=false")}});return b};d.prototype.getBatchLatLngs=function(b){return b.map(function(a){return a.errors?{title:a.title,errors:a.errors}:this.getLatLngFromAddress(a)},this)};d.prototype.addMarker=function(b){if(!b.errors){var a=new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lng),map:this.map,title:b.locations,animation:google.maps.Animation.DROP});
this.markers.push(a);g.call(this,a,b)}};d.prototype.createMarkersFromLatLngs=function(b){b.forEach(function(a){this.addMarker(a)},this);c.call(this,this.map)};d.prototype.deleteMarkers=function(){c.call(this,null);this.markers=[]};e.exports=d},{}],3:[function(d,e,f){e.exports=function(c){google.maps.event.addDomListener(window,"load",function(){var d={center:new google.maps.LatLng(37.767967,-122.442717),zoom:13,styles:[{elementType:"geometry",stylers:[{visibility:"simplified"},{hue:"#006eff"},{lightness:-7},
{saturation:16},{gamma:0.62}]},{featureType:"water",stylers:[{color:"#23c183"},{lightness:5}]}]};c.GoogleMaps.map=new google.maps.Map(document.getElementById("map-canvas"),d)})}},{}],4:[function(d,e,f){Storage.prototype.setObject=function(c,d){this.setItem(c,JSON.stringify(d))};Storage.prototype.getObject=function(c){return(c=this.getItem(c))&&JSON.parse(c)}},{}],5:[function(d,e,f){var c=d("./utils");d=function(){this.data};d.prototype.filterBy=function(b,a){var c=[];this.data.forEach(function(d){d.locations&&
d[b].trim()===a.trim()&&c.push(d)});return g(c)};d.prototype.fetchCachedOrFreshData=function(){function b(){var a;$.ajax({url:"http://data.sfgov.org/resource/yitu-d5am.json",dataType:"json",async:!1,success:function(b){a=b}});return a}if(Modernizr.localstorage){var a=localStorage.getObject("SFMoviesData");if(a)this.data=a;else{this.data=b();try{localStorage.setObject("SFMoviesData",this.data)}catch(c){return!1}}}else this.data=b()};d.prototype.collectAllAttributes=function(b){var a=[];this.data.forEach(function(c){c.locations&&
a.push(c[b].trim())});return c.removeDuplicateRecords(a)};e.exports=d;var g=function(b){var a=c.cloneArrayOfObjects(b);(function(){a.forEach(function(a){a.errors||(a.locations=a.locations.concat(", San Francisco, CA"))})})();(function(){a.forEach(function(a){a.errors||!a.locations.indexOf("(")&&!a.locations.indexOf(")")||(a.locations=a.locations.replace("(","").replace(")",""))})})();(function(){a.forEach(function(a){!a.errors&&a.locations.indexOf("&")&&(a.locations=a.locations.replace(/&/g,"and"))})})();
return a}},{"./utils":7}],6:[function(d,e,f){function c(c){c.forEach(function(b){b.errors&&($("div.alert-info").is(":hidden")&&$("div.alert-info").show(),$("div.alert-info").append("<p>We could not locate <em>"+b.locations+'</em> for the movie <strong>"'+b.title+'"</strong></p>'))})}TypeaheadClient={data:{},context:{},initialize:function(c){0===Object.keys(this.data).length?console.log("EMPTY TYPEAHEAD DATA"):(this.context=c,$("#title.typeahead").typeahead({name:"movieTitles",local:this.data.titles,
items:8,header:"<div class='tt-header'>Movie Titles</div>"}),$("#director.typeahead").typeahead({name:"directors",local:this.data.directors,items:8,header:"<div class='tt-header'>Directors</div>"}),$("#release_year.typeahead").typeahead({name:"releaseYears",local:this.data.releaseYears.sort(function(b,a){return a-b}),items:8,header:"<div class='tt-header'>Release Years</div>"}))},setupListeners:function(){$("input#title.typeahead").on("typeahead:selected",this.selectedCallback);$("input#director.typeahead").on("typeahead:selected",
this.selectedCallback);$("input#release_year.typeahead").on("typeahead:selected",this.selectedCallback)},selectedCallback:function(d,b){$("div.alert-info").empty();$("div.alert-info").hide();TypeaheadClient.context.GoogleMaps.deleteMarkers();$(this).parent().siblings().children("input.tt-query").val("");var a=App.SFMoviesClient.filterBy(d.currentTarget.id,b.value),a=App.GoogleMaps.getBatchLatLngs(a);TypeaheadClient.context.mobileMediaQuery.matches||c(a);TypeaheadClient.context.GoogleMaps.createMarkersFromLatLngs(a)}};
e.exports=TypeaheadClient},{}],7:[function(d,e,f){Utils={removeDuplicateRecords:function(c){return c.filter(function(d,b){return c.indexOf(d)===b})},cloneArrayOfObjects:function(c){return c.map(function(c){return $.extend({},c)})}};e.exports=Utils},{}]},{},[1]);